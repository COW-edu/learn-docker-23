# 2장 도커의 기본적인 사용법

## 도커의 기본적인 workflow
* 빌드 : 애플리케이션을 컨테이너에서 실행할 수 있도록 패키징
* 공유 : 다른 사람이 패키지를 사용할 수 있도록 공유
* 실행 : 패키지를 내려받은 사람이 컨테이너를 통해 애플리케이션 실행

## 도커 컨테이너 vs 가상 머신
* 격리와 밀집의 관점에서, 컨테이너는 두 조건을 모두 충족함. 하지만, 가상 머신의 경우 밀집이 어렵다는 차이가 있다.
  * 격리란 기본적으로 도커가 관리하는 컨테이너, 가상 머신 등이 서로 독립적인 환경을 갖는것을 말한다.
  * 밀집이란, 컴퓨터 CPU가 메모리 허용치 내에서, 많은 수의 어플리케이션을 실행하는 것을 말한다.
    * 가상 머신은 자신만의 운영체제를 별도로 가지며, 이를 유지하는 데 CPU와 메모리 자원이 상당히 소요된다.

## 기본적인 도커 사용법
* `docker container run --interactive, --tty diamol/base` : 해당 이미지로부터 대화식 컨테이너를 실행한다.
* `docker container top` : 실행중인 프로세스 목록 출력
* `docker container logs` : 로그 출력
* `docker container inspect` : 대상 컨테이너 상세 정보 출력

++ 알아두어야 할 사실
1. 컨테이너의 내부 애플리케이션이 실행 중이어야 컨테이너의 상태도 실행 중으로 된다.
* 종료된 컨테이너는 CPU, 메모리 자원을 사용하지 않는다.

2. 컨테이너가 종료되어도 컨테이너는 사라지지 않는다.
* 재실행, 로그, 파일 시스템에 새로운 파일 복사, 외부 복사가 모두 가능하다.
* 파일 시스템은 그대로 남아 있기 때문에, 명시적 삭제를 하지 않는 한, 디스크 공간을 점유하고 있다.

3. 컨테이너의 IP 주소는 도커가 관리하는 내부 가상 네트워크의 주소이다.
* 호스트 컴퓨터가 연결된 물리 네트워크에 연결된 것이 아니다.

### 컨테이너에서 간단한 웹 사이트 호스팅하기
컨테이너를 실행하고 백그라운드에서 계속 동작하게 하려면 어떻게 해야 할까?

`docker container run`에서, 두 개의 플래그 적용이 필요함
* `--detach` : 컨테이너를 백그라운드에서 실행하며 컨테이너 ID를 출력한다.
* `--publish` : 컨테이너의 포트를 호스트 컴퓨터에 공개한다.

컨테이너의 포트를 호스트 컴퓨터에 공개하는 원리는, 도커 설치 시 호스트 컴퓨터의 네트워크 계층에
도커가 끼어들게 되는데, 호스트 컴퓨터를 들어갔다 나오는 네트워크 트래픽을 모두 도커가 가로채어 필요한 것을 전달한다.

즉, 도커가 호스트 컴퓨터의 포트를 주시하다가 해당 포트로 들어오는 트래픽을 컨테이너로 전달해 주는 것이다.

## 도커 컨테이너 실행 원리
![image](https://github.com/COW-edu/learn-docker-23/assets/59856002/6b8d8f7d-5a73-49cb-bcd7-3a42ef00f845)

* 도커 엔진 : 도커의 관리 기능을 맡는 컴포넌트이다. 로컬 이미지 캐시를 담당하며, 호스트 운영체제와 함께 컨테이너, 가상 네트워크 등의 **도커 리소스**를 만드는 일도 담당한다. 도커 엔진은 항시 동작하는 백그라운드 프로세스다.
* 도커 API : 도커 엔진은 도커 API를 통해 기능을 수행하며, 외부에서 도커 엔진의 기능에 접근하려면 도커 API를 거쳐야 한다.
* 도커 CLI : 도커 API의 Client 격, 도커 명령 사용시 실제 도커 API를 호출.

### References
* 도커 교과서 - ch2. 도커의 기본적인 사용법
* https://thebook.io/080258/0023