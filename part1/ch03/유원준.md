# 3장 도커 이미지 만들기

## 도커 이미지란
* 서비스 운영에 필요한 서버 프로그램, 소스코드, 라이브러리, 실행파일을 묶는 형태를 말한다.
* 특정 프로세스를 실행하기 위한 모든 파일과 설정값을 지닌 것이다.

* 도커 이미지는 여러 이미지가 계층적으로 쌓인 형태로 저장된다.
  * 각 파일을 이미지 레이어라고 부르며, 도커 엔진의 캐시에 물리적으로 여러 개가 저장되어 있다.
* 이미지는 dockerHub를 통해 버전 관리 및 배포가 가능하다.
* 도커는 Dockerfile이라는 파일로 이미지를 만든다.

## 도커파일이란?
* 애플리케이션을 패키징하기 위한 간단한 script를 말한다.

```shell
FROM diamol/node

ENV TARGET = "blog.sixeyed.com"
ENV METHOD = "HEAD"
ENV INTERNAL="3000"
WORKDIR /web-ping

COPY app.js .

CMD ["node", "/web-ping/app.js"]
```

* `FROM` : 모든 도커 이미지는 다른 이미지로부터 출발한다. 해당 이미지의 시작점을 정의한다. 시작 이미지에는 해당 이미지 실행을 위한 Node.js가 존재한다.
* `ENV` : 환경 변수값을 저장하기 위한 인스트럭션
* `WORKDIR` : 컨테이너 이미지 파일 시스템에 디렉토리를 만들고, 작업 디렉토리로 지정한다.
* `COPY` : 로컬 파일 시스템의 파일, 디렉토리를 컨테이너 이미지로 복사한다.
* `CMD` : 도커가 이미지로부터 컨테이너를 실행했을 때, 실행할 명령을 지정한다.

### Dockerfile 스크립트 최적화
* Docker file script의 인스트럭션은 각각 하나의 이미지 레이어와 1:1로 연결된다.
* 인스트럭션의 결과가 같다면 해시값을 이용해 캐시된 레이어를 재사용한다.
* 한번 인스트럭션이 실행되면 이어지는 인스트럭션은 수정된 것이 없더라도 모두 실행된다.
  * 따라서 수정 빈도가 잦은 인스트럭션을 스크립트 뒤쪽에 배치해야 한다.

### References
* 도커 교과서 - ch3. 도커 이미지 만들기