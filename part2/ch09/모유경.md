# 도커의 모니터링

`#docker`

### 목차

- [도커의 모니터링](#✏️-도커의-모니터링)
  - [(컨테이너 vs 일반) 환경 모니터링](#🔎-컨테이너-vs-일반-환경-모니터링)
- [프로메테우스](#✏️-프로메테우스)
  - [출력정보](#🔎-출력정보)
- [그라파나](#✏️-그라파나)
  - [대시보드](#🔎-대시보드)
- [참고 문헌](#📖-참고-문헌)

  <div style="height:100px"></div>

- 자동 스케일링 기능과 헬스체크를 추가하면 컨테이너 플렛폼이 다양한 업무를 수행할 수 있지만, 만약을 위해서 지속적인 애플리케이션 모니터링과 이상 발생시 통보 기능이 필요

  > 자동 스케일링 기능
  >
  > - 애플리케이션에 들어오는 트래픽 부하에 맞춰 규모 조절
  > - 간헐적 오류에 대응해 스스로 복원

- 투명성 확보를 위해서 모니터링 기술로 프로메테우스를 사용
  > 투명성(observability)
  >
  > - 애플리케이션의 상태 및 문제 발생에 대한 원인을 파악가능

## ✏️ 도커의 모니터링

- 프로메테우스를 사용해 애플리케이션 컨테이너에서 측정된 수치를 수집하고 그라파나를 사용해 수치를 시각화해 이해하기 쉬운 대시보드 형태로 구성
- 개발환경과 운영 환경을 막론한 어떤 환경에서도 동등하게 애플리케이션의 성능을 확인가능

### 🔎 (컨테이너 vs 일반) 환경 모니터링

#### 전통적인 애플리케이션 모니터링

- 서버의 목록과 현재 동작상태가 표시된 대시보드가 존재
- 과부하에 걸리거나 응답하지않는 서버가 발생시 경보가 울림

#### 컨테이너화된 애플리케이션 모니터링

- 구조

  - 수십~ 수백개의 컨테이너에 걸쳐 애플리케이션이 실행되며, 컨테이너는 플랫폼에 의해서 끊임없이 생성 및 삭제를 반복하는 형태를 띰

- 요구사항 및 도구
  - 컨테이너를 다룰 수 있으며 컨테이너 플랫폼과 연동해 정적인 컨테이너 혹은 IP주소 목록 없이도 실행중인 애플리케이션을 볼 수 있는 도구를 갖춘 모니터링 방식이 필요 -> 프로메테우스로 해결
  <div style="height:100px"></div>

## ✏️ 프로메테우스

- 오픈소스도구
- 컨테이너에서 동작하므로 분산 애플리케이션에 모니터링 추가 가능
- 모니터링의 중요한 측면인 일관성이 확보
  - 모든 애플리케이션이 똑같이 구성된 측정값을 내놓으므로 모든 애플리케이션을 똑같은 표준형태로 모니터링 가능
  - 측정값 추출을 위한 쿼리 언어도 한 가지만 익힐 수 있으며 전체 애플리케이션 스택에 똑같은 모니터링을 적용가능
  - 도커 엔진의 측정값도 같은 형식으로 추출 가능
    - 도커 엔진 설정에서 프로메테우스 측정 기능을 명시적으로 활성화해야함

### 🔎 출력정보

- 츨정된 각 상태 정보가 이름-값 쌍 형태로 표현되는 텍스트 기반 포맷
- 이름-값 쌍 형태 앞에는 어떤 정보인지, 값의 데이터 타입은 무엇인지 안내 설명 포함
- 정보 항목마다 별도의 엔드 포인트를 통해 실시간으로 값을 제공
  - 이 값을 수집하면서 타임스탬프 값을 덧붙여 저장하므로 저장된 값을 정리해 시간에 따른 값의 변화를 추적 가능
- 상태별 컨테이너 수, 실패한 헬스 체크 횟수 등의 고수준 정보부터 도커 엔진이 점유 중인 메모리 용량 같은 저수준정보까지 다양하게 확인 가능
- 로그로 남길 가치가 있는 모든 정보는 로그보다는 측정값으로 수집하는 편이 메모리, 디스크용량, CPU시간 면에서 저렴하고 추세를 볼 수 있도록 시각화하기에도 쉬움
  <div style="height:100px"></div>

## ✏️ 그라파나

- 프로메테우스 웹 UI는 현재 설정을 확인하는 데도 유용하지만, 이 자체가 대시보드하고 하기에는 어려우므로 대시보드를 생성하기 위해서는 그라파나를 사용해야함
- 프로메테우스를 사용해 데이터를 수집한 이후, 표준적인 절차가 존재
  - 측정값을 열람하거나 데이터 시각화를 위한 쿼리를 확인하고 조정하는 데는 프로메투스 웹 UI를 사용
  - 쿼리를 연결해 대시보드를 구성하는데는 그라파나를 사용
- 현대적인 애플리케이션의 모니터링도구로 가장 널리쓰이며, 다양한 데이터 소스로부터 질의 수행 및 여러 시스템에게 경고를 보내는 기능을 갖춤

### 🔎 대시보드

- 애플리케이션의 모든 구성 요소와 도커 런타임의 상태를 한 눈에 알 수 있는 유용한 수단
- 시각화된 그래프 하나하나는 PromQL로 작성된 단일 쿼리로 그려짐
  - 쿼리는 측정값의 취합이나 필터링 이상의 복잡한 작업을 필요로 하지않음
- 지연시간, 트래픽, 오류, 가용 시스템 자원을 측정값으로 지목하는 것을 골든 시그널로 칭함
- 그래프는 절대적인 값보다는 변화하는 추세에서 알 수 있는 정보가 더 많음

  - 평균값에서 벗어나 수치가 튀는 순간이 언젠지, 컴포넌트의 이상현상과의 상관관계 등

  <div style="height:150px"></div>

### 📖 참고 문헌

도커 교과서 제 2부 컨테이너로 분산 애플리케이션 실행하기 Ch09
